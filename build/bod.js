(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;e={},v=n=u=l=m=t=s=k=null,d={gravity:1,windSpeed:.1,bedsCountThatGives:10,whenGiveBeds:100},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.remove=function(a,b){var c,d;return c=this.slice((b||a)+1||this.length),this.length=null!=(d=0>a)?d:this.length+{from:a},this.push.apply(this,c)},p=function(a){return document.getElementById(a)},o=function(a){return document.getElementsByClassName(a)},q=function(a){return document.getElementsByTagName(a)},Math.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},Math.radiansToDegrees=function(a){return a*(180/Math.PI)},Math.degreesToRadians=function(a){return a*(Math.PI/180)},e.start=function(){return v=new PIXI.Stage(16777215),u=new PIXI.WebGLRenderer(window.w,window.h),u.view.style.zIndex=1,document.body.appendChild(u.view),n=new PIXI.DisplayObjectContainer,v.addChild(n),l=new PIXI.TilingSprite(PIXI.Texture.fromImage("https://pp.vk.me/c621626/v621626450/c761/xvMcA2K8uJo.jpg")),l.position={x:0,y:0},l.width=window.w,l.height=window.h,l.alpha=.1,n.addChild(l),m=[],t=new g(window.w/2,window.h/2),s=new f(t.s.position.x-window.w/2),new b(0),k=0,requestAnimFrame(i)},e.restart=function(){return new b(0),t.beds=d.bedsCountThatGives,t.s.speedX=10*Math.random(),t.s.position.x=0,h.jumpedBeds=0,h.mileage=0},e.resize=function(){var a,b,c,d;for(window.w=window.innerWidth,window.h=window.innerHeight,u.resize(window.w,window.h),s.s.width=window.w,s.s.position.y=window.h-s.s.height,d=[],b=0,c=m.length;c>b;b++)a=m[b],d.push(a.s.position.y=window.h-s.s.height-a.s.height);return d},e.tick=function(){return t.s.position.x+=t.s.speedX,t.s.position.y+=t.s.speedY,t.s.speedY+=d.gravity,k+=d.gravity,t.s.speedX-=d.windSpeed,t.s.position.y>window.h-t.s.height-s.s.height&&(r(t.s.position.x,t.s.width)&&(h.jumpedBeds+=1),t.s.speedY=Math.abs(t.s.speedY)-k/50,k=0,t.s.speedY*=-1,t.s.position.y=window.h-t.s.height-s.s.height),c.set({x:window.w/2-t.s.position.x,y:u.offset.y}),s.updatePosition(t.s.position.x),l.position.x=t.s.position.x-window.w/2,l.tilePosition.x=t.s.position.x/10,t.s.position.x>h.mileage&&(h.mileage=t.s.position.x),h.mileage>h.bestMileage&&(h.bestMileage=h.mileage),t.checkIsNeedBeds(),h.update()},j=[],a=function(){function a(a,b,c){this.s=a,this.p=b,this.t=c,this.p0={x:this.s.position.x,y:this.s.position.y},this.t0=Date.now(),this.i=j.length,j.push(this)}return a.prototype.update=function(){return this.s.position.x!==this.p.x||this.s.position.y!==this.p.y?(this.s.position.x+=this.delta(this.p0.x,this.p.x),this.s.position.y+=this.delta(this.p0.y,this.p.y)):this.remove()},a.prototype.remove=function(){return j.splice(this.i-1,1)},a.prototype.delta=function(a,b){return((b-a)/this.t).toFixed()},a}(),w=function(){var a,b,c,d;for(d=[],b=0,c=j.length;c>b;b++)a=j[b],d.push(a.update());return d},c={set:function(a){return u.offset=new PIXI.Point(a.x,a.y)}},g=function(){function a(){return this.s=new PIXI.Sprite(PIXI.Texture.fromImage("assets/textures/player.png")),this.s.position.x=0,this.s.position.y=0,this.s.width=.128*window.w,this.s.height=.256*window.h,this.s.speedX=10*Math.random(),this.s.speedY=10*Math.random()-5,n.addChild(this.s),this.enableControl(this),this}return a.prototype.enableControl=function(a){return window.onkeydown=function(c){switch(c.keyCode){case 65:case 37:if(a.s.speedX>-10)return a.s.speedX-=Math.randomInt(1,2.5);break;case 68:case 39:if(a.s.speedX<10)return a.s.speedX+=Math.randomInt(1,2.5);break;case 32:if(a.beds>0)return new b(a.s.position.x),a.beds-=1}},window.DeviceOrientationEvent?(window.addEventListener("deviceorientation",function(b){if(a.alpha=b.alpha,b.alpha<180){if(b.alpha<=90){if(a.s.speedX<10)return a.s.speedX+=(90-b.alpha)/10}else if(a.s.speedX>-10)return a.s.speedX-=(b.alpha-90)/10}else if(b.alpha<=270){if(a.s.speedX<10)return a.s.speedX+=(270-b.alpha)/10}else if(a.s.speedX>-10)return a.s.speedX-=(b.alpha-270)/10},!1),document.body.addEventListener("touchend",function(){var c;return a.beds>0?(a.alpha<90?c=90-a.alpha:a.alpha>=90&&a.alpha<180?c=-(a.alpha-90):a.alpha>=180&&a.alpha<270?c=270-a.alpha:a.alpha>=270&&a.alpha<=360&&(c=-(a.alpha-270)),new b(a.s.position.x-c)):void 0},!1)):void 0},a.prototype.checkIsNeedBeds=function(){var a;return a=h.mileage/100,(a-a%d.whenGiveBeds)/d.whenGiveBeds>this.timesBedsBeenGiven?(this.timesBedsBeenGiven+=1,this.beds+=d.bedsCountThatGives):void 0},a.prototype.timesBedsBeenGiven=0,a.prototype.beds=10,a.prototype.alpha=null,a}(),m=[],b=function(){function a(a){var b;Math.random()>.2?(b="assets/textures/bed.png",this.lifes=2):(b="assets/textures/broken_bed.png",this.lifes=1),this.s=new PIXI.Sprite(PIXI.Texture.fromImage(b)),this.s.width=.256*window.w,this.s.height=.128*window.h,this.s.position.x=a,this.s.position.y=window.h-s.s.height-this.s.height,m.push(this),n.addChild(this.s)}return a}(),r=function(a,b){var c,d,e;for(d=0,e=m.length;e>d;d++)if(c=m[d],a+b>=c.s.position.x&&a+b<=c.s.position.x+c.s.width||a>=c.s.position.x&&a<=c.s.position.x+c.s.width){switch(c.lifes-=1,c.lifes){case 1:c.s.texture=PIXI.Texture.fromImage("assets/textures/broken_bed.png");break;case 0:n.removeChild(c.s),m.splice(m.indexOf(c),1)}return c}},f=function(){function a(a){return this.s=new PIXI.TilingSprite(PIXI.Texture.fromImage("http://i.imgur.com/5rVPkJJ.png")),this.s.width=window.w,this.s.height=.064*window.h,this.s.position={x:a,y:window.h-this.s.height},this.s.tilePosition={x:0,y:0},v.addChild(this.s),this}return a.prototype.updatePosition=function(a){return this.s.position.x=a-window.w/2,this.s.tilePosition.x=-a/2},a}(),h={jumpedBeds:0,mileage:0,bestMileage:0,update:function(){return p("alpha").innerText="ALPHA: "+t.alpha,p("speed").innerText="SPEED: "+t.s.speedX,p("beds").innerText="BEDS: "+t.beds,p("mileage").innerText="MILEAGE: "+(h.mileage/100).toFixed()+"m",p("bestMileage").innerText="BEST: "+(h.bestMileage/100).toFixed()+"m"}},document.body.addEventListener("touchmove",function(a){return a.preventDefault()},!1),window.onresize=e.resize,window.w=window.innerWidth,window.h=window.innerHeight,i=function(){return requestAnimFrame(i),e.tick(),w(),u.render(v)},e.start(),e.resize()}).call(this);