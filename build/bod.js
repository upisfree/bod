(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;d={gravity:1,windSpeed:.1,bedsCountThatGives:10,whenGiveBeds:100},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.remove=function(a,b){var c,d;return c=this.slice((b||a)+1||this.length),this.length=null!=(d=0>a)?d:this.length+{from:a},this.push.apply(this,c)},n=function(a){return document.getElementById(a)},m=function(a){return document.getElementsByClassName(a)},o=function(a){return document.getElementsByTagName(a)},Math.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},Math.radiansToDegrees=function(a){return a*(180/Math.PI)},Math.degreesToRadians=function(a){return a*(Math.PI/180)},i=[],a=function(){function a(a,b,c){this.s=a,this.p=b,this.t=c,this.p0={x:this.s.position.x,y:this.s.position.y},this.t0=Date.now(),this.i=i.length,i.push(this)}return a.prototype.update=function(){return this.s.position.x!==this.p.x||this.s.position.y!==this.p.y?(this.s.position.x+=this.delta(this.p0.x,this.p.x),this.s.position.y+=this.delta(this.p0.y,this.p.y)):this.remove()},a.prototype.remove=function(){return i.splice(this.i-1,1)},a.prototype.delta=function(a,b){return((b-a)/this.t).toFixed()},a}(),w=function(){var a,b,c,d;for(d=[],b=0,c=i.length;c>b;b++)a=i[b],d.push(a.update());return d},c={set:function(a){return s.offset=new PIXI.Point(a.x,a.y)}},f=function(){function a(){return this.s=new PIXI.Sprite(PIXI.Texture.fromImage("http://i.imgur.com/fFEVrQr.png")),this.s.position.x=0,this.s.position.y=0,this.s.width=100,this.s.height=100,this.s.speedX=10*Math.random(),this.s.speedY=10*Math.random()-5,l.addChild(this.s),this.enableControl(this),this}return a.prototype.enableControl=function(a){return window.onkeydown=function(c){switch(c.keyCode){case 65:case 37:if(a.s.speedX>-10)return a.s.speedX-=Math.randomInt(1,2.5);break;case 68:case 39:if(a.s.speedX<10)return a.s.speedX+=Math.randomInt(1,2.5);break;case 32:if(a.beds>0)return new b(a.s.position.x),a.beds-=1}}},a.prototype.checkIsNeedBeds=function(){var a;return a=g.mileage/100,(a-a%d.whenGiveBeds)/d.whenGiveBeds>this.timesBedsBeenGiven?(this.timesBedsBeenGiven+=1,this.beds+=d.bedsCountThatGives):void 0},a.prototype.timesBedsBeenGiven=0,a.prototype.beds=10,a}(),k=[],b=function(){function a(a){var b;Math.random()>.2?(b="http://i.imgur.com/Upp8GdF.png",this.lifes=2):(b="http://i.imgur.com/LfhMygw.png",this.lifes=1),this.s=new PIXI.Sprite(PIXI.Texture.fromImage(b)),this.s.width=200,this.s.height=100,this.s.position.x=a,this.s.position.y=window.h-q.s.height-this.s.height,k.push(this),l.addChild(this.s)}return a}(),p=function(a,b){var c,d,e;for(d=0,e=k.length;e>d;d++)if(c=k[d],a+b>=c.s.position.x&&a+b<=c.s.position.x+c.s.width||a>=c.s.position.x&&a<=c.s.position.x+c.s.width){switch(c.lifes-=1,c.lifes){case 1:c.s.texture=PIXI.Texture.fromImage("http://i.imgur.com/LfhMygw.png");break;case 0:l.removeChild(c.s),k.splice(k.indexOf(c),1)}return c}},e=function(){function a(a){return this.s=new PIXI.TilingSprite(PIXI.Texture.fromImage("http://i.imgur.com/5rVPkJJ.png"),window.w,64),this.s.position={x:a,y:window.h-this.s.height},this.s.tilePosition={x:0,y:0},u.addChild(this.s),this}return a.prototype.updatePosition=function(a){return this.s.position.x=a-window.w/2,this.s.tilePosition.x=-a/2},a}(),g={jumpedBeds:0,mileage:0,bestMileage:0,update:function(){return n("beds").innerText="BEDS: "+r.beds,n("mileage").innerText="MILEAGE: "+(g.mileage/100).toFixed()+"m",n("bestMileage").innerText="BEST: "+(g.bestMileage/100).toFixed()+"m"}},document.body.addEventListener("touchmove",function(a){return a.preventDefault()},!1),window.w=window.innerWidth,window.h=window.innerHeight,u=new PIXI.Stage(16777215),s=new PIXI.WebGLRenderer(window.w,window.h),s.view.style.zIndex=1,document.body.appendChild(s.view),j=new PIXI.TilingSprite(PIXI.Texture.fromImage("https://pp.vk.me/c621626/v621626450/c761/xvMcA2K8uJo.jpg")),j.position={x:0,y:0},j.width=window.w,j.height=window.h,j.alpha=.1,u.addChild(j),l=new PIXI.DisplayObjectContainer,u.addChild(l),k=[],r=new f(window.w/2,window.h/2),q=new e(r.s.position.x-window.w/2),new b(0),t=function(){return new b(0),r.beds=d.bedsCountThatGives,r.s.speedX=10*Math.random(),r.s.position.x=0,g.jumpedBeds=0,g.mileage=0},v=function(){return r.s.position.x+=r.s.speedX,r.s.position.y+=r.s.speedY,r.s.speedY+=d.gravity,r.s.speedX-=d.windSpeed,r.s.position.y>window.h-r.s.height-q.s.height&&(p(r.s.position.x,r.s.width)?g.jumpedBeds+=1:t(),r.s.speedY*=-.95,r.s.position.y=window.h-r.s.height-q.s.height),c.set({x:window.w/2-r.s.position.x,y:s.offset.y}),q.updatePosition(r.s.position.x),j.position.x=r.s.position.x-window.w/2,j.tilePosition.x=r.s.position.x/10,r.s.position.x>g.mileage&&(g.mileage=r.s.position.x),g.mileage>g.bestMileage&&(g.bestMileage=g.mileage),r.checkIsNeedBeds(),g.update()},h=function(){return requestAnimFrame(h),v(),w(),s.render(u)},requestAnimFrame(h)}).call(this);